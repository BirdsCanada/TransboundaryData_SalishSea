<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Data Processing | Transboundary avian data for the Salish Sea</title>
  <meta name="description" content="Data documentation and R scripts to compile transboundary sea duck data for the Salish Sea" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Data Processing | Transboundary avian data for the Salish Sea" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://github.com/DMEthier/DataCompile-SDJV/NC.png" />
  <meta property="og:description" content="Data documentation and R scripts to compile transboundary sea duck data for the Salish Sea" />
  <meta name="github-repo" content="DMEthier/DataCompile-SDJV" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Data Processing | Transboundary avian data for the Salish Sea" />
  
  <meta name="twitter:description" content="Data documentation and R scripts to compile transboundary sea duck data for the Salish Sea" />
  <meta name="twitter:image" content="https://github.com/DMEthier/DataCompile-SDJV/NC.png" />

<meta name="author" content="Author: Danielle Ethier and Dean Evans" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="CBC7.html"/>
<link rel="next" href="ADD9.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="mystyles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Transboundary avain data for the Salish Sea: An R users guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome data users!</a></li>
<li class="chapter" data-level="1" data-path="Intro1.html"><a href="Intro1.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Intro1.html"><a href="Intro1.html#Intro1.1"><i class="fa fa-check"></i><b>1.1</b> Project Summary</a></li>
<li class="chapter" data-level="1.2" data-path="Intro1.html"><a href="Intro1.html#Intro1.2"><i class="fa fa-check"></i><b>1.2</b> Goals</a></li>
<li class="chapter" data-level="1.3" data-path="Intro1.html"><a href="Intro1.html#Intro1.3"><i class="fa fa-check"></i><b>1.3</b> Scope</a></li>
<li class="chapter" data-level="1.4" data-path="Intro1.html"><a href="Intro1.html#Intro1.4"><i class="fa fa-check"></i><b>1.4</b> Guide Structure</a></li>
<li class="chapter" data-level="1.5" data-path="Intro1.html"><a href="Intro1.html#Intro1.5"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="BCCWS2.html"><a href="BCCWS2.html"><i class="fa fa-check"></i><b>2</b> BCCWS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.1"><i class="fa fa-check"></i><b>2.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="2.2" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.2"><i class="fa fa-check"></i><b>2.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="2.3" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.3"><i class="fa fa-check"></i><b>2.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="2.4" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.4"><i class="fa fa-check"></i><b>2.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="2.5" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.5"><i class="fa fa-check"></i><b>2.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="2.6" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.6"><i class="fa fa-check"></i><b>2.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="2.7" data-path="BCCWS2.html"><a href="BCCWS2.html#BCCWS2.7"><i class="fa fa-check"></i><b>2.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="BCMA3.html"><a href="BCMA3.html"><i class="fa fa-check"></i><b>3</b> BCMA</a>
<ul>
<li class="chapter" data-level="3.1" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.1"><i class="fa fa-check"></i><b>3.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="3.2" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.2"><i class="fa fa-check"></i><b>3.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="3.3" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.3"><i class="fa fa-check"></i><b>3.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="3.4" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.4"><i class="fa fa-check"></i><b>3.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="3.5" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.5"><i class="fa fa-check"></i><b>3.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="3.6" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.6"><i class="fa fa-check"></i><b>3.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="3.7" data-path="BCMA3.html"><a href="BCMA3.html#BCMA3.7"><i class="fa fa-check"></i><b>3.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="PSSS4.html"><a href="PSSS4.html"><i class="fa fa-check"></i><b>4</b> PSSS</a>
<ul>
<li class="chapter" data-level="4.1" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.1"><i class="fa fa-check"></i><b>4.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="4.2" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.2"><i class="fa fa-check"></i><b>4.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="4.3" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.3"><i class="fa fa-check"></i><b>4.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="4.4" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.4"><i class="fa fa-check"></i><b>4.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="4.5" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.5"><i class="fa fa-check"></i><b>4.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="4.6" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.6"><i class="fa fa-check"></i><b>4.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="4.7" data-path="PSSS4.html"><a href="PSSS4.html#PSSS4.7"><i class="fa fa-check"></i><b>4.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="PSEMP5.html"><a href="PSEMP5.html"><i class="fa fa-check"></i><b>5</b> PSEMP</a>
<ul>
<li class="chapter" data-level="5.1" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.1"><i class="fa fa-check"></i><b>5.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="5.2" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.2"><i class="fa fa-check"></i><b>5.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="5.3" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.3"><i class="fa fa-check"></i><b>5.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="5.4" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.4"><i class="fa fa-check"></i><b>5.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="5.5" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.5"><i class="fa fa-check"></i><b>5.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="5.6" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.6"><i class="fa fa-check"></i><b>5.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="5.7" data-path="PSEMP5.html"><a href="PSEMP5.html#PSEMP5.7"><i class="fa fa-check"></i><b>5.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="eBird6.html"><a href="eBird6.html"><i class="fa fa-check"></i><b>6</b> eBird</a>
<ul>
<li class="chapter" data-level="6.1" data-path="eBird6.html"><a href="eBird6.html#eBird6.1"><i class="fa fa-check"></i><b>6.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="6.2" data-path="eBird6.html"><a href="eBird6.html#eBird6.2"><i class="fa fa-check"></i><b>6.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="6.3" data-path="eBird6.html"><a href="eBird6.html#eBird6.3"><i class="fa fa-check"></i><b>6.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="6.4" data-path="eBird6.html"><a href="eBird6.html#eBird6.4"><i class="fa fa-check"></i><b>6.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="6.5" data-path="eBird6.html"><a href="eBird6.html#eBird6.5"><i class="fa fa-check"></i><b>6.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="6.6" data-path="eBird6.html"><a href="eBird6.html#eBird6.6"><i class="fa fa-check"></i><b>6.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="6.7" data-path="eBird6.html"><a href="eBird6.html#eBird6.7"><i class="fa fa-check"></i><b>6.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="CBC7.html"><a href="CBC7.html"><i class="fa fa-check"></i><b>7</b> CBC</a>
<ul>
<li class="chapter" data-level="7.1" data-path="CBC7.html"><a href="CBC7.html#CBC7.1"><i class="fa fa-check"></i><b>7.1</b> Quick Data Overview</a></li>
<li class="chapter" data-level="7.2" data-path="CBC7.html"><a href="CBC7.html#CBC7.2"><i class="fa fa-check"></i><b>7.2</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="7.3" data-path="CBC7.html"><a href="CBC7.html#CBC7.3"><i class="fa fa-check"></i><b>7.3</b> Avian Data Collected</a></li>
<li class="chapter" data-level="7.4" data-path="CBC7.html"><a href="CBC7.html#CBC7.4"><i class="fa fa-check"></i><b>7.4</b> Auxiliary Data Collected</a></li>
<li class="chapter" data-level="7.5" data-path="CBC7.html"><a href="CBC7.html#CBC7.5"><i class="fa fa-check"></i><b>7.5</b> Data Access, Permission, and Format</a></li>
<li class="chapter" data-level="7.6" data-path="CBC7.html"><a href="CBC7.html#CBC7.6"><i class="fa fa-check"></i><b>7.6</b> Data Use Considerations</a></li>
<li class="chapter" data-level="7.7" data-path="CBC7.html"><a href="CBC7.html#eBird7.7"><i class="fa fa-check"></i><b>7.7</b> Data Use Examples</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Data9.html"><a href="Data9.html"><i class="fa fa-check"></i><b>8</b> Data Processing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Data9.html"><a href="Data9.html#Data9.1"><i class="fa fa-check"></i><b>8.1</b> Data Schema</a></li>
<li class="chapter" data-level="8.2" data-path="Data9.html"><a href="Data9.html#Data9.2"><i class="fa fa-check"></i><b>8.2</b> Species Codes</a></li>
<li class="chapter" data-level="8.3" data-path="Data9.html"><a href="Data9.html#Data9.3"><i class="fa fa-check"></i><b>8.3</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="Data9.html"><a href="Data9.html#Data9.3.1"><i class="fa fa-check"></i><b>8.3.1</b> BCCWS &amp; BCMA</a></li>
<li class="chapter" data-level="8.3.2" data-path="Data9.html"><a href="Data9.html#Data9.3.2"><i class="fa fa-check"></i><b>8.3.2</b> PSSS</a></li>
<li class="chapter" data-level="8.3.3" data-path="Data9.html"><a href="Data9.html#Data9.3.3"><i class="fa fa-check"></i><b>8.3.3</b> PSEMP</a></li>
<li class="chapter" data-level="8.3.4" data-path="Data9.html"><a href="Data9.html#Data9.3.4"><i class="fa fa-check"></i><b>8.3.4</b> eBird</a></li>
<li class="chapter" data-level="8.3.5" data-path="Data9.html"><a href="Data9.html#Data9.3.5"><i class="fa fa-check"></i><b>8.3.5</b> CBC</a></li>
<li class="chapter" data-level="8.3.6" data-path="Data9.html"><a href="Data9.html#Data9.3.6"><i class="fa fa-check"></i><b>8.3.6</b> All Data Combined</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="Data9.html"><a href="Data9.html#Data9.4"><i class="fa fa-check"></i><b>8.4</b> Zero-filling dataframe</a></li>
<li class="chapter" data-level="8.5" data-path="Data9.html"><a href="Data9.html#Data9.5"><i class="fa fa-check"></i><b>8.5</b> Checking and removing duplicates</a></li>
<li class="chapter" data-level="8.6" data-path="Data9.html"><a href="Data9.html#Data9.6"><i class="fa fa-check"></i><b>8.6</b> Assigning survey period</a></li>
<li class="chapter" data-level="8.7" data-path="Data9.html"><a href="Data9.html#Data9.7"><i class="fa fa-check"></i><b>8.7</b> Remove out of range species/ unsuitable habitat</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ADD9.html"><a href="ADD9.html"><i class="fa fa-check"></i><b>9</b> Additional Data Resources</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ADD9.html"><a href="ADD9.html#ADD9.1"><i class="fa fa-check"></i><b>9.1</b> Canadian Pacific Vessel-Based Survey</a></li>
<li class="chapter" data-level="9.2" data-path="ADD9.html"><a href="ADD9.html#ADD9.2"><i class="fa fa-check"></i><b>9.2</b> Pelagic Seabird Atlas</a></li>
<li class="chapter" data-level="9.3" data-path="ADD9.html"><a href="ADD9.html#ADD9.3"><i class="fa fa-check"></i><b>9.3</b> North Pacific Pelagic Seabird Database (NPPSD)</a></li>
<li class="chapter" data-level="9.4" data-path="ADD9.html"><a href="ADD9.html#ADD9.4"><i class="fa fa-check"></i><b>9.4</b> Coastal Observation and Seabird Survey Team (COASST)</a></li>
<li class="chapter" data-level="9.5" data-path="ADD9.html"><a href="ADD9.html#ADD9.5"><i class="fa fa-check"></i><b>9.5</b> Regional Population Monitoring of the Marbled Murrelet (WDFW)</a></li>
<li class="chapter" data-level="9.6" data-path="ADD9.html"><a href="ADD9.html#ADD9.6"><i class="fa fa-check"></i><b>9.6</b> Cherry Point Aquatic and Fidalgo Bay Aquatic Reserve shore-based monitoring (DNR - WA)</a></li>
<li class="chapter" data-level="9.7" data-path="ADD9.html"><a href="ADD9.html#ADD9.7"><i class="fa fa-check"></i><b>9.7</b> Additional Historical Datasets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Transboundary avian data for the Salish Sea</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Data9" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Data Processing<a href="Data9.html#Data9" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><strong>Before continuing with this chapter, please review the content in Chapters 2-7. It is the responsibility of the data user to understand the various data collection protocols, stipulations around data access, and data use considerations.</strong></p>
</blockquote>
<p>Start by loading the packages needed for this chapter</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="Data9.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;remotes&quot;)</span></span>
<span id="cb1-2"><a href="Data9.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github(&quot;BirdsCanada/naturecounts&quot;)</span></span>
<span id="cb1-3"><a href="Data9.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="Data9.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naturecounts)</span>
<span id="cb1-5"><a href="Data9.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="Data9.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-7"><a href="Data9.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(auk)</span>
<span id="cb1-8"><a href="Data9.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(measurements)</span>
<span id="cb1-9"><a href="Data9.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-10"><a href="Data9.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape)</span></code></pre></div>
<div id="Data9.1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Data Schema<a href="Data9.html#Data9.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The purpose of this chapter is to provide the data user R script which will enable the compilation of disparate avian data sources into a standardized format (also known as a schema). The format selected for the purposes of this project was the Bird Monitoring Data Exchange (<a href="https://naturecounts.ca/nc/default/nc_bmde.jsp">BMDE</a>), which is the core standard of <a href="https://naturecounts.ca/nc/default/main.jsp">NatureCounts</a> a node of the <a href="https://avianknowledge.net/">Avian Knowledge Network</a>. The BMDE includes 169 core fields for capturing all metric and descriptors associated with bird observations. You can use the naturecounts R package and the following scripts to view the BMDE core fields. A copy of the BMDE table is also in the <code>BMDE</code> folder of this directory, which provides additional descriptions of the core columns.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Data9.html#cb2-1" aria-hidden="true" tabindex="-1"></a>BMDE<span class="ot">&lt;-</span><span class="fu">meta_bmde_fields</span>(<span class="st">&quot;core&quot;</span>)</span></code></pre></div>
<p>Any data owners wishing to contribute their data to the NatureCounts database should complete the metadata form, also found in the BMDE folder, and reach out to Catherine Jardin: <a href="mailto:cjardine@birdscanada.org" class="email">cjardine@birdscanada.org</a>, Birds Canada’s Data Analyst.</p>
</div>
<div id="Data9.2" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Species Codes<a href="Data9.html#Data9.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A crucial steps to combining datasets is the inclusion of a common species code. Let’s compile the complete species list now for use later in the data compilation. The data tables you will need can be accessed using the naturecounts R package.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Data9.html#cb3-1" aria-hidden="true" tabindex="-1"></a>sp.code<span class="ot">&lt;-</span><span class="fu">meta_species_codes</span>()</span>
<span id="cb3-2"><a href="Data9.html#cb3-2" aria-hidden="true" tabindex="-1"></a>sp.code<span class="ot">&lt;-</span>sp.code <span class="sc">%&gt;%</span> <span class="fu">filter</span>(authority<span class="sc">==</span><span class="st">&quot;BSCDATA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>authority, <span class="sc">-</span>species_id2, <span class="sc">-</span>rank) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb3-3"><a href="Data9.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="Data9.html#cb3-4" aria-hidden="true" tabindex="-1"></a>sp.tax<span class="ot">&lt;-</span><span class="fu">meta_species_taxonomy</span>()</span>
<span id="cb3-5"><a href="Data9.html#cb3-5" aria-hidden="true" tabindex="-1"></a>sp.tax<span class="ot">&lt;-</span>sp.tax <span class="sc">%&gt;%</span> <span class="fu">select</span>(species_id, scientific_name, english_name) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb3-6"><a href="Data9.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="Data9.html#cb3-7" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span><span class="fu">left_join</span>(sp.code, sp.tax, <span class="at">by=</span><span class="st">&quot;species_id&quot;</span>)</span>
<span id="cb3-8"><a href="Data9.html#cb3-8" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span>sp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(english_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="Data9.3" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Data Manipulation<a href="Data9.html#Data9.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All data sets need to be manipulated before they are used for an analysis. Anyone that uses big datasets for research will tell you that it often takes more time to manipulate and filter the data than doing the actual statistical analysis. I therefore cannot cover all the possible data manipulations you will do, but will give you some sample script to help compile a contemporary dataset of birds using the tansboundary waters of the Salish Sea.</p>
<p>To accommodate the R scripts in this chapter, data samples for each dataset are provided in the <code>Data</code> folder. These samples are structured in the same format you will receive the raw data from the data owner.</p>
<p>There are data column in the raw dataset that are not carried over to the BMDE. We do retain any information which could be used for effort correction, but some auxiliary data is lost which could bee used if developing a occupancy model. If you are a data user, you should inspect the raw data columns to ensure there is nothing that you need dropped from the final datatable. You can change the code below to retain additional columns as needed.</p>
<div id="Data9.3.1" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> BCCWS &amp; BCMA<a href="Data9.html#Data9.3.1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start with two Canadian datasets that are already in the BMDE schema and accessible through <a href="https://naturecounts.ca/nc/default/main.jsp">NatureCounts</a>. The <a href="BCCWS2.html#BCCWS2">BCCWS</a> and <a href="#id_#BCMA3">BCMA</a> are accessible through the NatureCounts web portal or directly using the naturecounts R package. Since the BCCWS is Access Level 3, you need to make a <a href="https://naturecounts.ca/nc/default/searchquery.jsp">data request</a>. Once your NatureCounts data request has been approved you will receive an email confirmation, which will contain your <code>request_id</code>. This number will be used to download your newly acquired dataset into R. The BCMA is open access, Level 5, and therefore a data <code>request_id</code> is not required.</p>
<p>If you are new to the naturecounts R package, I recommend you start by reviewing the <a href="https://birdscanada.github.io/NatureCounts_IntroTutorial/">Introductory R Tutorial</a>. Those materials will not be repeated here.</p>
<p>Below is some sample code for downloading the BCCWS and BCMA datasets. You will replace the <code>request_id</code> and <code>username</code> with your own credentials. To retrieve the core BMDE columns, you will want the <code>fields_set</code> to be set to “core” (as below).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="Data9.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naturecounts) </span>
<span id="cb4-2"><a href="Data9.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="Data9.html#cb4-3" aria-hidden="true" tabindex="-1"></a>BCCWS<span class="ot">&lt;-</span><span class="fu">nc_data_dl</span>(<span class="at">collection=</span><span class="st">&quot;BCCWS&quot;</span>, <span class="at">username =</span> <span class="st">&quot;YOUR USERNAME&quot;</span>, <span class="at">info=</span><span class="st">&quot;MY REASON&quot;</span>, <span class="at">fields_set =</span> <span class="st">&quot;core&quot;</span>)</span>
<span id="cb4-4"><a href="Data9.html#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="Data9.html#cb4-5" aria-hidden="true" tabindex="-1"></a>BCMA<span class="ot">&lt;-</span><span class="fu">nc_data_dl</span>(<span class="at">collection=</span><span class="st">&quot;BCMA&quot;</span>, <span class="at">username =</span> <span class="st">&quot;YOUR USERNAME&quot;</span>, <span class="at">info=</span><span class="st">&quot;MY REASON&quot;</span>, <span class="at">fields_set =</span> <span class="st">&quot;core&quot;</span>)</span></code></pre></div>
<p>Working with the sample datasets.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="Data9.html#cb5-1" aria-hidden="true" tabindex="-1"></a>BCCWS<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/BCCWS_sample.csv&quot;</span>) </span>
<span id="cb5-2"><a href="Data9.html#cb5-2" aria-hidden="true" tabindex="-1"></a>BCMA<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/BCMA_sample.csv&quot;</span>)  </span>
<span id="cb5-3"><a href="Data9.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="Data9.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#select only core BMDE columns, since they seem to vary</span></span>
<span id="cb5-5"><a href="Data9.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naturecounts)</span>
<span id="cb5-6"><a href="Data9.html#cb5-6" aria-hidden="true" tabindex="-1"></a>BMDE<span class="ot">&lt;-</span><span class="fu">meta_bmde_fields</span>(<span class="st">&quot;core&quot;</span>)</span>
<span id="cb5-7"><a href="Data9.html#cb5-7" aria-hidden="true" tabindex="-1"></a>BMDE_col<span class="ot">&lt;-</span><span class="fu">unique</span>(BMDE<span class="sc">$</span>local_name)</span>
<span id="cb5-8"><a href="Data9.html#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="Data9.html#cb5-9" aria-hidden="true" tabindex="-1"></a>BCCWS<span class="ot">&lt;-</span>BCCWS <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(BMDE_col)) </span>
<span id="cb5-10"><a href="Data9.html#cb5-10" aria-hidden="true" tabindex="-1"></a>BCMA<span class="ot">&lt;-</span>BCMA <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(BMDE_col)) </span>
<span id="cb5-11"><a href="Data9.html#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="Data9.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#There seems to be some duplicates in the full BCCWS dataset that need removed. </span></span>
<span id="cb5-13"><a href="Data9.html#cb5-13" aria-hidden="true" tabindex="-1"></a>BCCWS<span class="ot">&lt;-</span>BCCWS <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(RouteIdentifier, SpeciesCode, YearCollected, MonthCollected, DayCollected, DecimalLatitude, DecimalLongitude, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-14"><a href="Data9.html#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="Data9.html#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Assign SurveyAreaIdentifier to RouteIdentifier for BCMA</span></span>
<span id="cb5-16"><a href="Data9.html#cb5-16" aria-hidden="true" tabindex="-1"></a>BCMA<span class="sc">$</span>RouteIdentifier<span class="ot">&lt;-</span>BCMA<span class="sc">$</span>SurveyAreaIdentifier</span></code></pre></div>
</div>
<div id="Data9.3.2" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> PSSS<a href="Data9.html#Data9.3.2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data will be received in an .xlsx file. Save as a .csv in the <code>Data</code> folder for processing using the following scripts. We will work with the sample dataset here which has the same formatting as the full dataset that you will receive.</p>
<p>Note: the sample dataframe is 50 rows long, but the output dataframe will be 65. How can this be!? This is because the raptors are recorded in rows with the other data and are extracted into their own rows to match the BMDE. This makes the data frame longer.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="Data9.html#cb6-1" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/PSSS_sample.csv&quot;</span>)</span>
<span id="cb6-2"><a href="Data9.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="Data9.html#cb6-3" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>lat<span class="ot">&lt;-</span><span class="fu">sub</span>(<span class="st">&quot; W.*&quot;</span>, <span class="st">&quot;&quot;</span>, PSSS<span class="sc">$</span>position)  </span>
<span id="cb6-4"><a href="Data9.html#cb6-4" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>long<span class="ot">&lt;-</span><span class="fu">sub</span>(<span class="st">&quot;.*W&quot;</span>, <span class="st">&quot;&quot;</span>, PSSS<span class="sc">$</span>position)</span>
<span id="cb6-5"><a href="Data9.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="Data9.html#cb6-6" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>lat <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">&#39;N&#39;</span>, <span class="st">&#39;&#39;</span>, PSSS<span class="sc">$</span>lat)</span>
<span id="cb6-7"><a href="Data9.html#cb6-7" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>long <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">&#39;W&#39;</span>, <span class="st">&#39;&#39;</span>, PSSS<span class="sc">$</span>long)</span>
<span id="cb6-8"><a href="Data9.html#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="Data9.html#cb6-9" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>DecimalLatitude <span class="ot">=</span> measurements<span class="sc">::</span><span class="fu">conv_unit</span>(PSSS<span class="sc">$</span>lat, <span class="at">from =</span> <span class="st">&#39;deg_dec_min&#39;</span>, <span class="at">to =</span> <span class="st">&#39;dec_deg&#39;</span>)</span>
<span id="cb6-10"><a href="Data9.html#cb6-10" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>DecimalLatitude<span class="ot">&lt;-</span><span class="fu">as.numeric</span>((PSSS<span class="sc">$</span>DecimalLatitude))</span>
<span id="cb6-11"><a href="Data9.html#cb6-11" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>DecimalLongitude <span class="ot">=</span> measurements<span class="sc">::</span><span class="fu">conv_unit</span>(PSSS<span class="sc">$</span>long, <span class="at">from =</span> <span class="st">&#39;deg_dec_min&#39;</span>, <span class="at">to =</span> <span class="st">&#39;dec_deg&#39;</span>)</span>
<span id="cb6-12"><a href="Data9.html#cb6-12" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>DecimalLongitude<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(PSSS<span class="sc">$</span>DecimalLongitude)</span>
<span id="cb6-13"><a href="Data9.html#cb6-13" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>DecimalLongitude<span class="ot">=</span>PSSS<span class="sc">$</span>DecimalLongitude<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb6-14"><a href="Data9.html#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="Data9.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#break apart survey_date and reform into day, month, year</span></span>
<span id="cb6-16"><a href="Data9.html#cb6-16" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">separate</span>(survey_date, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;del&quot;</span>), <span class="at">sep=</span><span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>del) <span class="sc">%&gt;%</span> <span class="fu">separate</span>(Date, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;YearCollected&quot;</span>, <span class="st">&quot;MonthCollected&quot;</span>, <span class="st">&quot;DayCollected&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>) </span>
<span id="cb6-17"><a href="Data9.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#wrangle raptor data into the long format since each species identification should be in a unique row. </span></span>
<span id="cb6-18"><a href="Data9.html#cb6-18" aria-hidden="true" tabindex="-1"></a>raptor1<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(raptor1 <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">common_name =</span> raptor1, <span class="at">bird_count =</span> raptor1_count, <span class="at">notes=</span> raptor1_affect)<span class="sc">%&gt;%</span>  <span class="fu">select</span>(<span class="sc">-</span>raptor1, <span class="sc">-</span>raptor2, <span class="sc">-</span>raptor3, <span class="sc">-</span>raptor1_count, <span class="sc">-</span>raptor2_count, <span class="sc">-</span>raptor3_count, <span class="sc">-</span>raptor1_affect, <span class="sc">-</span>raptor2_affect, <span class="sc">-</span>raptor3_affect) </span>
<span id="cb6-19"><a href="Data9.html#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="Data9.html#cb6-20" aria-hidden="true" tabindex="-1"></a>raptor1<span class="ot">&lt;-</span>raptor1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name, common_name, YearCollected, MonthCollected, DayCollected) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">bird_count=</span><span class="fu">sum</span>(bird_count)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(common_name, site_name, YearCollected, MonthCollected, DayCollected, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-21"><a href="Data9.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="Data9.html#cb6-22" aria-hidden="true" tabindex="-1"></a>raptor2<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(raptor2 <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">common_name =</span> raptor2, <span class="at">bird_count =</span> raptor2_count, <span class="at">notes=</span> raptor2_affect)<span class="sc">%&gt;%</span>  <span class="fu">select</span>(<span class="sc">-</span>raptor1, <span class="sc">-</span>raptor2, <span class="sc">-</span>raptor3, <span class="sc">-</span>raptor1_count, <span class="sc">-</span>raptor2_count, <span class="sc">-</span>raptor3_count, <span class="sc">-</span>raptor1_affect, <span class="sc">-</span>raptor2_affect, <span class="sc">-</span>raptor3_affect) </span>
<span id="cb6-23"><a href="Data9.html#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="Data9.html#cb6-24" aria-hidden="true" tabindex="-1"></a>raptor2<span class="ot">&lt;-</span>raptor2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name, common_name, YearCollected, MonthCollected, DayCollected) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">bird_count=</span><span class="fu">sum</span>(bird_count)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(common_name, site_name, YearCollected, MonthCollected, DayCollected, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-25"><a href="Data9.html#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="Data9.html#cb6-26" aria-hidden="true" tabindex="-1"></a>raptor3<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(raptor3 <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">common_name =</span> raptor3, <span class="at">bird_count =</span> raptor3_count, <span class="at">notes=</span> raptor3_affect) <span class="sc">%&gt;%</span>  <span class="fu">select</span>(<span class="sc">-</span>raptor1, <span class="sc">-</span>raptor2, <span class="sc">-</span>raptor3, <span class="sc">-</span>raptor1_count, <span class="sc">-</span>raptor2_count, <span class="sc">-</span>raptor3_count, <span class="sc">-</span>raptor1_affect, <span class="sc">-</span>raptor2_affect, <span class="sc">-</span>raptor3_affect) </span>
<span id="cb6-27"><a href="Data9.html#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="Data9.html#cb6-28" aria-hidden="true" tabindex="-1"></a>raptor3<span class="ot">&lt;-</span>raptor3 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name, common_name, YearCollected, MonthCollected, DayCollected) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">bird_count=</span><span class="fu">sum</span>(bird_count)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(common_name, site_name, YearCollected, MonthCollected, DayCollected, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-29"><a href="Data9.html#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="Data9.html#cb6-30" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span>  <span class="fu">select</span>(<span class="sc">-</span>raptor1, <span class="sc">-</span>raptor2, <span class="sc">-</span>raptor3, <span class="sc">-</span>raptor1_count, <span class="sc">-</span>raptor2_count, <span class="sc">-</span>raptor3_count, <span class="sc">-</span>raptor1_affect, <span class="sc">-</span>raptor2_affect, <span class="sc">-</span>raptor3_affect) </span>
<span id="cb6-31"><a href="Data9.html#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="Data9.html#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">#bind raptor data back with PSSS data</span></span>
<span id="cb6-33"><a href="Data9.html#cb6-33" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span><span class="fu">rbind</span>(PSSS, raptor1)</span>
<span id="cb6-34"><a href="Data9.html#cb6-34" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span><span class="fu">rbind</span>(PSSS, raptor2)</span>
<span id="cb6-35"><a href="Data9.html#cb6-35" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span><span class="fu">rbind</span>(PSSS, raptor3)</span>
<span id="cb6-36"><a href="Data9.html#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="Data9.html#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">#remove rows with missing common name</span></span>
<span id="cb6-38"><a href="Data9.html#cb6-38" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(common_name <span class="sc">!=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-39"><a href="Data9.html#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="Data9.html#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#remove bearing and distance because we want each species/ site/ date to be a single row in the data set similar to BBCWS</span></span>
<span id="cb6-41"><a href="Data9.html#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="Data9.html#cb6-42" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>bearing, <span class="sc">-</span>dist)</span>
<span id="cb6-43"><a href="Data9.html#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="Data9.html#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co">#Now summarize the records per species/ site/ date</span></span>
<span id="cb6-45"><a href="Data9.html#cb6-45" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name, common_name, YearCollected, MonthCollected, DayCollected) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">bird_count=</span><span class="fu">sum</span>(bird_count)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(common_name, site_name, YearCollected, MonthCollected, DayCollected, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-46"><a href="Data9.html#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="Data9.html#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co">#replace Thayer&#39;s Gull with Ivory Gull</span></span>
<span id="cb6-48"><a href="Data9.html#cb6-48" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">common_name =</span> <span class="fu">ifelse</span>(common_name <span class="sc">==</span> <span class="st">&quot;Thayer&#39;s Gull&quot;</span>, <span class="st">&quot;Ivory Gull&quot;</span>, common_name))</span>
<span id="cb6-49"><a href="Data9.html#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="Data9.html#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge with species ID</span></span>
<span id="cb6-51"><a href="Data9.html#cb6-51" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span><span class="fu">merge</span>(PSSS, sp, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">&quot;common_name&quot;</span>), <span class="at">by.y=</span> (<span class="st">&quot;english_name&quot;</span>), <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-52"><a href="Data9.html#cb6-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-53"><a href="Data9.html#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">#rename data columns to match BMDE</span></span>
<span id="cb6-54"><a href="Data9.html#cb6-54" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">CommonName =</span>common_name, <span class="at">SurveyAreaIdentifier=</span> survey_site_id, <span class="at">Locality =</span> site_name, <span class="at">MinimumElevationInMeters=</span>elevation, <span class="at">MaximumElevationInMeters=</span>elevation, <span class="at">TimeObservationsStarted=</span>start_time, <span class="at">TimeCollected =</span> start_time, <span class="at">TimeObservationsEnded=</span>end_time, <span class="at">ObservationCount =</span> bird_count, <span class="at">ObservationCount2=</span>large_flock_best, <span class="at">ObsCountAtLeast =</span> large_flock_min, <span class="at">ObsCountAtMost =</span> large_flock_max, <span class="at">FieldNotes=</span>notes, <span class="at">Collector =</span> name, <span class="at">ScientificName=</span>scientific_name, <span class="at">SpeciesCode=</span>species_code, <span class="at">AllSpeciesReported=</span>is_complete)</span>
<span id="cb6-55"><a href="Data9.html#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="Data9.html#cb6-56" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>RouteIdentifier<span class="ot">&lt;-</span>PSSS<span class="sc">$</span>Locality</span>
<span id="cb6-57"><a href="Data9.html#cb6-57" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>BasisOfRecord <span class="ot">&lt;-</span> <span class="st">&quot;Observation&quot;</span></span>
<span id="cb6-58"><a href="Data9.html#cb6-58" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>CollectionCode <span class="ot">&lt;-</span> <span class="st">&quot;PSSS&quot;</span></span>
<span id="cb6-59"><a href="Data9.html#cb6-59" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>Continent <span class="ot">&lt;-</span><span class="st">&quot;North America&quot;</span></span>
<span id="cb6-60"><a href="Data9.html#cb6-60" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>Country<span class="ot">&lt;-</span><span class="st">&quot;United States&quot;</span></span>
<span id="cb6-61"><a href="Data9.html#cb6-61" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>StateProvince<span class="ot">&lt;-</span><span class="st">&quot;Washington&quot;</span></span>
<span id="cb6-62"><a href="Data9.html#cb6-62" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>ProtocolType <span class="ot">&lt;-</span> <span class="st">&quot;PointCount&quot;</span></span>
<span id="cb6-63"><a href="Data9.html#cb6-63" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>ProtocolSpeciesTargeted <span class="ot">&lt;-</span> <span class="st">&quot;Waterbirds&quot;</span></span>
<span id="cb6-64"><a href="Data9.html#cb6-64" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>ProtocolURL<span class="ot">=</span> <span class="st">&quot;https://seattleaudubon.org/wp-content/uploads/2021/01/PSSS_Protocol_2014-15.pdf&quot;</span></span>
<span id="cb6-65"><a href="Data9.html#cb6-65" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>SurveyAreaShape <span class="ot">=</span> <span class="st">&quot;300 m&quot;</span></span>
<span id="cb6-66"><a href="Data9.html#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">#PSSS$EffortUnit1 = &quot;Party-hours&quot;</span></span>
<span id="cb6-67"><a href="Data9.html#cb6-67" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>ObservationDescriptor <span class="ot">=</span> <span class="st">&quot;Total Count&quot;</span></span>
<span id="cb6-68"><a href="Data9.html#cb6-68" aria-hidden="true" tabindex="-1"></a>PSSS<span class="sc">$</span>ObservationDescriptor2 <span class="ot">=</span> <span class="st">&quot;Large flock best estiamte&quot;</span> </span>
<span id="cb6-69"><a href="Data9.html#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="Data9.html#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Now that we have specified all the data columns we can, we will create the BMDE standardized data table. </span></span>
<span id="cb6-71"><a href="Data9.html#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="Data9.html#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="co">#Identify the missing columns of data</span></span>
<span id="cb6-73"><a href="Data9.html#cb6-73" aria-hidden="true" tabindex="-1"></a>BMDE_col<span class="ot">&lt;-</span><span class="fu">unique</span>(BMDE<span class="sc">$</span>local_name)</span>
<span id="cb6-74"><a href="Data9.html#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="Data9.html#cb6-75" aria-hidden="true" tabindex="-1"></a>missing<span class="ot">&lt;-</span><span class="fu">setdiff</span>(BMDE_col, <span class="fu">names</span>(PSSS))</span>
<span id="cb6-76"><a href="Data9.html#cb6-76" aria-hidden="true" tabindex="-1"></a>PSSS[missing]<span class="ot">&lt;-</span><span class="st">&quot; &quot;</span></span>
<span id="cb6-77"><a href="Data9.html#cb6-77" aria-hidden="true" tabindex="-1"></a>PSSS<span class="ot">&lt;-</span>PSSS[BMDE_col]</span></code></pre></div>
</div>
<div id="Data9.3.3" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> PSEMP<a href="Data9.html#Data9.3.3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data will be downloaded as a .gdb file, which is a proprietary format of ESRI meaning the data are not suited for exchange with other applications. My suggestion is that you (or your GIS analyst) import the data layers into ArcGIS, and export tables in .txt. format for import into Excel. Then save as .csv in the <code>Data</code> directory of this project.</p>
<p>The tables provided will include:</p>
<ul>
<li>PSEMP_Survey_Observations (PSEMP_sample.csv): This is a point layer storing processed bird observation data recorded during the winter fixed-wing aerial shorebird surveys. There are two observers in the plane, one on each side facing outward, that record their observations into an audio recording device along with timestamp information and position data from an on-board GPS receiver. This data is later transcribed into tab-delimited files along with a timestamped track-log for the plane (also tab-delimited). This source data are then imported into GIS format and a series of geoprocessing scripts are run which project these points spatially 63 meters at right angles to either side of the plane as well as filtering them (to reduce the chance of double counting) and adding additional attribute information.</li>
</ul>
<blockquote>
<p><strong>You will want to add the X and Y coordinates to this table before you export it from ArcGIS. If you are not familiar with how to do this, you will find some useful instructions <a href="https://support.esri.com/en/technical-article/000002217">here</a>.</strong></p>
</blockquote>
<ul>
<li><p>PSEMP_SurveyRoutes: This is a polyline GIS data layer representing the flight path of the fixed wing plane recorded (initially as a series of point locations) during the winter fixed-wing aerial shorebird surveys.</p></li>
<li><p>PSEMP_SurveyArea: This is a polygon data layer that represents the area considered to be visually surveyed during the annual winter fixed-wing aerial shorebird surveys. The data consist of rectangular strips that run parallel to the flight path of the plane. The strips are 50 meters wide and are centered 63 meters to either side of the plane. Locations of shorebird observations recorded along the flight path are spatially projected into the center of these strips. The purpose of the strips is to provide an estimate of surveyed area as well as serving as inputs in a process wherein some shorebird observations are removed from areas of survey strip overlap in an effort to minimize the chances of double counting birds.</p></li>
<li><p>Species (PSEMP_species.csv): This table lists the avian species groups recorded during the winter fixed-wing aerial shorebird surveys. It provides species common and scientific names as well as the species codes (TaxoNameID) necessary to crosswalk these species to group membership (for composite groups analyzed) and to other WDFW databases.</p></li>
<li><p>PSEMP_Group: This table provides a list of composite groups of species surveys. Some of these groups were included in subsequent statistical analysis; these groups are noted in the “StatsRun” attribute.</p></li>
<li><p>SpeciesPSEMP_Group: This associative table allows species observations to be crosswalked to composite groups that they participate in.</p></li>
<li><p>PSEMP_SpeciesObservation_Attribute.xlsx: This is an extra table that was attained from the PSEMP group directly. It contains descriptors of the <code>PSEMP_Survey_Observations</code> layer. A copy of this table is saved in the <code>Data</code> director.</p></li>
</ul>
<p>We will work with the sample dataset here which has the same formatting as the full dataset that you will receive through the online download.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="Data9.html#cb7-1" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/PSEMP_sample.csv&quot;</span>) <span class="co">#note the x and y were added in ArcGIS before export.</span></span>
<span id="cb7-2"><a href="Data9.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="Data9.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Get species code information from the NatureCounts R package (duplicate scripts)</span></span>
<span id="cb7-4"><a href="Data9.html#cb7-4" aria-hidden="true" tabindex="-1"></a>sp.code<span class="ot">&lt;-</span><span class="fu">meta_species_codes</span>()</span>
<span id="cb7-5"><a href="Data9.html#cb7-5" aria-hidden="true" tabindex="-1"></a>sp.code<span class="ot">&lt;-</span>sp.code <span class="sc">%&gt;%</span> <span class="fu">filter</span>(authority<span class="sc">==</span><span class="st">&quot;BSCDATA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>authority, <span class="sc">-</span>species_id2, <span class="sc">-</span>rank) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb7-6"><a href="Data9.html#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="Data9.html#cb7-7" aria-hidden="true" tabindex="-1"></a>sp.tax<span class="ot">&lt;-</span><span class="fu">meta_species_taxonomy</span>()</span>
<span id="cb7-8"><a href="Data9.html#cb7-8" aria-hidden="true" tabindex="-1"></a>sp.tax<span class="ot">&lt;-</span>sp.tax <span class="sc">%&gt;%</span> <span class="fu">select</span>(species_id, scientific_name, english_name) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb7-9"><a href="Data9.html#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="Data9.html#cb7-10" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span><span class="fu">left_join</span>(sp.code, sp.tax, <span class="at">by=</span><span class="st">&quot;species_id&quot;</span>)</span>
<span id="cb7-11"><a href="Data9.html#cb7-11" aria-hidden="true" tabindex="-1"></a>sp<span class="ot">&lt;-</span>sp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(english_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-12"><a href="Data9.html#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="Data9.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#load the PSEMP species table</span></span>
<span id="cb7-14"><a href="Data9.html#cb7-14" aria-hidden="true" tabindex="-1"></a>sp_PSEMP<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/PSEMP_species.csv&quot;</span>)</span>
<span id="cb7-15"><a href="Data9.html#cb7-15" aria-hidden="true" tabindex="-1"></a>sp_PSEMP<span class="ot">&lt;-</span>sp_PSEMP <span class="sc">%&gt;%</span> <span class="fu">select</span>(TaxoNameID, PSEMP_CommonName, PSEMP_SpeciesCode, PSEMP_SciName1) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TaxoNameID<span class="sc">&gt;=</span><span class="dv">1</span>)</span>
<span id="cb7-16"><a href="Data9.html#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="Data9.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#some species codes need changed in order to properly link this with the sp table from the NatureCounts database. </span></span>
<span id="cb7-18"><a href="Data9.html#cb7-18" aria-hidden="true" tabindex="-1"></a>sp_PSEMP<span class="ot">&lt;-</span>sp_PSEMP <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Cormorant, Brandt&#39;s&quot;</span>, <span class="st">&quot;BRAC&quot;</span>, PSEMP_SpeciesCode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-19"><a href="Data9.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Plover, American golden&quot;</span>, <span class="st">&quot;AMGP&quot;</span>, PSEMP_SpeciesCode)) <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Duck, harlequin&quot;</span>, <span class="st">&quot;HARD&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Gull, herring&quot;</span>, <span class="st">&quot;HERG&quot;</span>, PSEMP_SpeciesCode)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Gull, Heermann&#39;s&quot;</span>, <span class="st">&quot;HEEG&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Shoveler, northern&quot;</span>, <span class="st">&quot;NSHO&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Crow, northwestern&quot;</span>, <span class="st">&quot;NOCR&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Hawk, red-tailed&quot;</span>, <span class="st">&quot;HAHA&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Gull, Thayer&#39;s&quot;</span>, <span class="st">&quot;ICGU&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Swan, trumpeter&quot;</span>, <span class="st">&quot;TRUS&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Goose, white-fronted&quot;</span>, <span class="st">&quot;GWFG&quot;</span>, PSEMP_SpeciesCode))  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PSEMP_SpeciesCode=</span><span class="fu">ifelse</span>(PSEMP_CommonName<span class="sc">==</span><span class="st">&quot;Pelican, American white&quot;</span>, <span class="st">&quot;AWPE&quot;</span>, PSEMP_SpeciesCode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-20"><a href="Data9.html#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(PSEMP_SpeciesCode<span class="sc">!=</span><span class="st">&quot;HAPO&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-21"><a href="Data9.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>TaxoNameID, <span class="sc">-</span>PSEMP_CommonName, <span class="sc">-</span>PSEMP_SciName1)</span>
<span id="cb7-22"><a href="Data9.html#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="Data9.html#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#join species tables</span></span>
<span id="cb7-24"><a href="Data9.html#cb7-24" aria-hidden="true" tabindex="-1"></a>sp_PSEMP<span class="ot">&lt;-</span><span class="fu">merge</span>(sp_PSEMP, sp, <span class="at">by.x=</span><span class="st">&quot;PSEMP_SpeciesCode&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;species_code&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-25"><a href="Data9.html#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="Data9.html#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#join to observation data</span></span>
<span id="cb7-27"><a href="Data9.html#cb7-27" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span><span class="fu">left_join</span>(PSEMP, sp_PSEMP, <span class="at">by=</span><span class="st">&quot;PSEMP_SpeciesCode&quot;</span>)</span>
<span id="cb7-28"><a href="Data9.html#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="Data9.html#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#remove any species that start with &#39;U&#39; as unidentified </span></span>
<span id="cb7-30"><a href="Data9.html#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="Data9.html#cb7-31" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(species_id))</span>
<span id="cb7-32"><a href="Data9.html#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="Data9.html#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#join to the area table</span></span>
<span id="cb7-34"><a href="Data9.html#cb7-34" aria-hidden="true" tabindex="-1"></a>area_PSEMP<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/PSEMP_SurveyArea.csv&quot;</span>)</span>
<span id="cb7-35"><a href="Data9.html#cb7-35" aria-hidden="true" tabindex="-1"></a>area_PSEMP<span class="ot">&lt;-</span>area_PSEMP <span class="sc">%&gt;%</span> <span class="fu">select</span>(TransectID, SurveyYear, Shape_Length, Shape_Area)</span>
<span id="cb7-36"><a href="Data9.html#cb7-36" aria-hidden="true" tabindex="-1"></a>area_PSEMP<span class="ot">&lt;-</span>area_PSEMP <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(TransectID, SurveyYear, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-37"><a href="Data9.html#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="Data9.html#cb7-38" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span><span class="fu">left_join</span>(PSEMP, area_PSEMP, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;TransectID&quot;</span>, <span class="st">&quot;SurveyYear&quot;</span>))</span>
<span id="cb7-39"><a href="Data9.html#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="Data9.html#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Separate data and time field into separate columns</span></span>
<span id="cb7-41"><a href="Data9.html#cb7-41" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>DateTimeFromLog<span class="ot">&lt;-</span><span class="fu">as.Date</span>(PSEMP<span class="sc">$</span>ObservationDateTime)</span>
<span id="cb7-42"><a href="Data9.html#cb7-42" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> <span class="fu">separate</span>(ObservationDateTime, <span class="fu">c</span>(<span class="st">&quot;YearCollected&quot;</span>, <span class="st">&quot;MonthCollected&quot;</span>, <span class="st">&quot;del&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb7-43"><a href="Data9.html#cb7-43" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> <span class="fu">separate</span>(del, <span class="fu">c</span>(<span class="st">&quot;DayCollected&quot;</span>, <span class="st">&quot;TimeCollected&quot;</span>), <span class="at">sep=</span><span class="st">&quot; &quot;</span>) </span>
<span id="cb7-44"><a href="Data9.html#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="Data9.html#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#rename columns to match BMDE</span></span>
<span id="cb7-46"><a href="Data9.html#cb7-46" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">RouteIdentifier=</span>TransectID, <span class="at">ProtocolType=</span>TransectType, CollectorNumber</span>
<span id="cb7-47"><a href="Data9.html#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="ot">=</span> ObserverID, <span class="at">SamplingEventIdentifier=</span>ObservationID, <span class="at">BearingInDegrees=</span>ObservationDegreesDTrue, <span class="at">DecimalLatitude=</span>Y, <span class="at">DecimalLongitude=</span>X, <span class="at">ScientificName =</span> scientific_name, <span class="at">SpeciesCode=</span>PSEMP_SpeciesCode, </span>
<span id="cb7-48"><a href="Data9.html#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="at">CommonName=</span>english_name, <span class="at">SurveyAreaSize=</span>Shape_Area, <span class="at">Remarks=</span>ObservationComment)</span>
<span id="cb7-49"><a href="Data9.html#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="Data9.html#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#1-Observation on shoreline transect; 2-Observation on open water transect; Unsure why some years are Null</span></span>
<span id="cb7-51"><a href="Data9.html#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="Data9.html#cb7-52" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ProtocolType=</span><span class="fu">ifelse</span>(ProtocolType<span class="sc">==</span><span class="dv">1</span>, <span class="st">&quot;Shoreline Transect&quot;</span>, <span class="fu">ifelse</span>(ProtocolType<span class="sc">==</span><span class="dv">2</span>, <span class="st">&quot;Open Water Transect&quot;</span>, <span class="st">&quot;Null&quot;</span>)))</span>
<span id="cb7-53"><a href="Data9.html#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="Data9.html#cb7-54" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>Locality<span class="ot">&lt;-</span>PSEMP<span class="sc">$</span>RouteIdentifier</span>
<span id="cb7-55"><a href="Data9.html#cb7-55" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>BasisOfRecord <span class="ot">&lt;-</span> <span class="st">&quot;Observation&quot;</span></span>
<span id="cb7-56"><a href="Data9.html#cb7-56" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>CollectionCode <span class="ot">&lt;-</span> <span class="st">&quot;PSEMP&quot;</span></span>
<span id="cb7-57"><a href="Data9.html#cb7-57" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>Continent <span class="ot">&lt;-</span><span class="st">&quot;North America&quot;</span></span>
<span id="cb7-58"><a href="Data9.html#cb7-58" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>Country<span class="ot">&lt;-</span><span class="st">&quot;United States&quot;</span></span>
<span id="cb7-59"><a href="Data9.html#cb7-59" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>StateProvince<span class="ot">&lt;-</span><span class="st">&quot;Washington&quot;</span></span>
<span id="cb7-60"><a href="Data9.html#cb7-60" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>ProtocolSpeciesTargeted <span class="ot">&lt;-</span> <span class="st">&quot;Waterbirds&quot;</span></span>
<span id="cb7-61"><a href="Data9.html#cb7-61" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>InstitutionCode<span class="ot">&lt;-</span><span class="st">&quot;PSEMP&quot;</span></span>
<span id="cb7-62"><a href="Data9.html#cb7-62" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="sc">$</span>NumberOfObservers<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb7-63"><a href="Data9.html#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="Data9.html#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove non-unique observations and sum results per location/ date (double observer)</span></span>
<span id="cb7-65"><a href="Data9.html#cb7-65" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(RouteIdentifier, SpeciesCode, YearCollected, MonthCollected, DayCollected, DecimalLatitude, DecimalLongitude) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ObservationCount=</span><span class="fu">sum</span>(ObservationCount)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(RouteIdentifier, SpeciesCode, YearCollected, MonthCollected, DayCollected, DecimalLatitude, DecimalLongitude, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-66"><a href="Data9.html#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="Data9.html#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co">#Now that we have specified all the data columns we can, we will create the BMDE standardized data table. #Identify the missing columns of data</span></span>
<span id="cb7-68"><a href="Data9.html#cb7-68" aria-hidden="true" tabindex="-1"></a>BMDE_col<span class="ot">&lt;-</span><span class="fu">unique</span>(BMDE<span class="sc">$</span>local_name)</span>
<span id="cb7-69"><a href="Data9.html#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="Data9.html#cb7-70" aria-hidden="true" tabindex="-1"></a>missing<span class="ot">&lt;-</span><span class="fu">setdiff</span>(BMDE_col, <span class="fu">names</span>(PSEMP))</span>
<span id="cb7-71"><a href="Data9.html#cb7-71" aria-hidden="true" tabindex="-1"></a>PSEMP[missing]<span class="ot">&lt;-</span><span class="st">&quot; &quot;</span></span>
<span id="cb7-72"><a href="Data9.html#cb7-72" aria-hidden="true" tabindex="-1"></a>PSEMP<span class="ot">&lt;-</span>PSEMP[BMDE_col]</span></code></pre></div>
</div>
<div id="Data9.3.4" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> eBird<a href="Data9.html#Data9.3.4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You will make an online request for eBird data scoped to the geographic region and temporal scale of choice. In this instance, I would request all the data for Washington and British Columbia from 2002-present. Each region needs to be requested separately. Once you have received the raw data files, you can save them in the <code>Data</code> directory of this folder. They will be BIG! Due to the large size of this dataset, it must be filtered to a smaller subset of desired observations before reading into R. This filtering is most efficiently done using <a href="https://cornelllabofornithology.github.io/auk/">auk: eBird Data Extraction and Processing with AWK</a> a Unix utility and programming language for processing column formatted text data. This package acts as a front end for AWK, allowing users to filter eBird data before import into R.</p>
<p>There will be several files in the .zip folder along with your raw data, including: BCRCodes, IBACodes, USFWSCodes, recommend citation, terms of use, and the metadata file.</p>
<p>We will once again work with the sample dataset here which has the same formatting as the full dataset that you will receive through the online download.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="Data9.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#start by setting the working directory of the abd files to the data directory of this project, where your data files should be saved</span></span>
<span id="cb8-2"><a href="Data9.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="Data9.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#getwd() # your current working directory</span></span>
<span id="cb8-4"><a href="Data9.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#auk_set_ebd_path(&quot;C:/Users/dethier/Documents/ethier-scripts/DataCompile-SDJV/Data/&quot;, overwrite=FALSE) # my current working directory (sample code)</span></span>
<span id="cb8-5"><a href="Data9.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="Data9.html#cb8-6" aria-hidden="true" tabindex="-1"></a>WA_in<span class="ot">&lt;-</span><span class="st">&quot;Data/eBirdWA_sample.txt&quot;</span></span>
<span id="cb8-7"><a href="Data9.html#cb8-7" aria-hidden="true" tabindex="-1"></a>WA_out<span class="ot">&lt;-</span><span class="st">&quot;Data/WA_filter.txt&quot;</span></span>
<span id="cb8-8"><a href="Data9.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="Data9.html#cb8-9" aria-hidden="true" tabindex="-1"></a>ebird_WA<span class="ot">&lt;-</span>WA_in <span class="sc">%&gt;%</span> <span class="fu">auk_ebd</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="Data9.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#define filters</span></span>
<span id="cb8-11"><a href="Data9.html#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_bcr</span>(<span class="at">bcr=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="Data9.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#auk_protocol(&quot;eBird Pelagic Protocol&quot;) %&gt;% </span></span>
<span id="cb8-13"><a href="Data9.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_protocol</span>(<span class="st">&quot;Stationary&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="Data9.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_filter</span>(<span class="at">file=</span>WA_out, <span class="at">overwrite=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-15"><a href="Data9.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_ebd</span>()</span>
<span id="cb8-16"><a href="Data9.html#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="Data9.html#cb8-17" aria-hidden="true" tabindex="-1"></a>BC_in<span class="ot">&lt;-</span><span class="st">&quot;Data/eBirdBC_sample.txt&quot;</span></span>
<span id="cb8-18"><a href="Data9.html#cb8-18" aria-hidden="true" tabindex="-1"></a>BC_out<span class="ot">&lt;-</span><span class="st">&quot;Data/BC_filter.txt&quot;</span></span>
<span id="cb8-19"><a href="Data9.html#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="Data9.html#cb8-20" aria-hidden="true" tabindex="-1"></a>ebird_BC<span class="ot">&lt;-</span>BC_in <span class="sc">%&gt;%</span> <span class="fu">auk_ebd</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-21"><a href="Data9.html#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#define filters</span></span>
<span id="cb8-22"><a href="Data9.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_bcr</span>(<span class="at">bcr=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-23"><a href="Data9.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#auk_protocol(&quot;eBird Pelagic Protocol&quot;) %&gt;% </span></span>
<span id="cb8-24"><a href="Data9.html#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_protocol</span>(<span class="st">&quot;Stationary&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-25"><a href="Data9.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_filter</span>(<span class="at">file=</span>BC_out, <span class="at">overwrite=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-26"><a href="Data9.html#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auk_complete</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="Data9.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_ebd</span>()</span>
<span id="cb8-28"><a href="Data9.html#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="Data9.html#cb8-29" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span><span class="fu">rbind</span>(ebird_BC, ebird_WA)</span>
<span id="cb8-30"><a href="Data9.html#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="Data9.html#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">#separate data and time columns</span></span>
<span id="cb8-32"><a href="Data9.html#cb8-32" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span>ebird_data <span class="sc">%&gt;%</span> <span class="fu">separate</span>(observation_date, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;YearCollected&quot;</span>, <span class="st">&quot;MonthCollected&quot;</span>, <span class="st">&quot;DayCollected&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>) </span>
<span id="cb8-33"><a href="Data9.html#cb8-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-34"><a href="Data9.html#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#rename columns</span></span>
<span id="cb8-35"><a href="Data9.html#cb8-35" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span>ebird_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span> (<span class="at">GlobalUniqueIdentifier=</span>global_unique_identifier, </span>
<span id="cb8-36"><a href="Data9.html#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="at">DateLastModified=</span>last_edited_date,  </span>
<span id="cb8-37"><a href="Data9.html#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="at">TaxonConceptID=</span>taxon_concept_id, </span>
<span id="cb8-38"><a href="Data9.html#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="at">CommonName=</span>common_name,     </span>
<span id="cb8-39"><a href="Data9.html#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="at">ScientificName=</span>scientific_name, </span>
<span id="cb8-40"><a href="Data9.html#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="at">ObservationCount=</span>observation_count, </span>
<span id="cb8-41"><a href="Data9.html#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="at">Country=</span>country_code, </span>
<span id="cb8-42"><a href="Data9.html#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="at">StateProvince=</span>state, </span>
<span id="cb8-43"><a href="Data9.html#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="at">SurveyAreaIdentifier=</span>locality_id,</span>
<span id="cb8-44"><a href="Data9.html#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="at">TimeCollected=</span>time_observations_started, </span>
<span id="cb8-45"><a href="Data9.html#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="at">CollectorNumber=</span>observer_id, </span>
<span id="cb8-46"><a href="Data9.html#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="at">SamplingEventIdentifier=</span>sampling_event_identifier, </span>
<span id="cb8-47"><a href="Data9.html#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="at">ProtocolType=</span>protocol_type, </span>
<span id="cb8-48"><a href="Data9.html#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="at">ProtocolCode=</span>protocol_code, </span>
<span id="cb8-49"><a href="Data9.html#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="at">ProjectCode=</span>project_code, </span>
<span id="cb8-50"><a href="Data9.html#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="at">DistanceFromStart=</span>effort_distance_km,</span>
<span id="cb8-51"><a href="Data9.html#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="at">SurveyAreaSize=</span>effort_area_ha,</span>
<span id="cb8-52"><a href="Data9.html#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="at">NumberOfObservers=</span>number_observers,</span>
<span id="cb8-53"><a href="Data9.html#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="at">AllIndividualsReported=</span>all_species_reported,</span>
<span id="cb8-54"><a href="Data9.html#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="at">Remarks=</span>trip_comments,</span>
<span id="cb8-55"><a href="Data9.html#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="at">Remarks2=</span>species_comments, </span>
<span id="cb8-56"><a href="Data9.html#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="at">DecimalLatitude=</span> latitude,</span>
<span id="cb8-57"><a href="Data9.html#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="at">DecimalLongitude=</span>longitude,</span>
<span id="cb8-58"><a href="Data9.html#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="at">Locality=</span>locality</span>
<span id="cb8-59"><a href="Data9.html#cb8-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-60"><a href="Data9.html#cb8-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-61"><a href="Data9.html#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">#Assign species_id and SpeciesCode</span></span>
<span id="cb8-62"><a href="Data9.html#cb8-62" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span><span class="fu">merge</span>(ebird_data, sp, <span class="at">by.x=</span><span class="st">&quot;CommonName&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;english_name&quot;</span>) </span>
<span id="cb8-63"><a href="Data9.html#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">#Some species may be lost in this merge. Looking for a way to fix this using the naturecounts package. </span></span>
<span id="cb8-64"><a href="Data9.html#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="Data9.html#cb8-65" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span>ebird_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SpeciesCode=</span>species_code)</span>
<span id="cb8-66"><a href="Data9.html#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="Data9.html#cb8-67" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>RouteIdentifier<span class="ot">&lt;-</span>ebird_data<span class="sc">$</span>Locality</span>
<span id="cb8-68"><a href="Data9.html#cb8-68" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>BasisOfRecord <span class="ot">&lt;-</span> <span class="st">&quot;Observation&quot;</span></span>
<span id="cb8-69"><a href="Data9.html#cb8-69" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>CollectionCode <span class="ot">&lt;-</span> <span class="st">&quot;EBIRD&quot;</span></span>
<span id="cb8-70"><a href="Data9.html#cb8-70" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>InstitutionCode<span class="ot">&lt;-</span><span class="st">&quot;Cornell&quot;</span></span>
<span id="cb8-71"><a href="Data9.html#cb8-71" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>Continent <span class="ot">&lt;-</span><span class="st">&quot;North America&quot;</span></span>
<span id="cb8-72"><a href="Data9.html#cb8-72" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="sc">$</span>ProtocolURL<span class="ot">&lt;-</span> <span class="st">&quot;https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols&quot;</span></span>
<span id="cb8-73"><a href="Data9.html#cb8-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-74"><a href="Data9.html#cb8-74" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span>ebird_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">DurationInHours =</span> duration_minutes<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb8-75"><a href="Data9.html#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="Data9.html#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">#Now that we have specified all the data columns we can, we will create the BMDE standardized data table. </span></span>
<span id="cb8-77"><a href="Data9.html#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="Data9.html#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="co">#Identify the missing columns of data</span></span>
<span id="cb8-79"><a href="Data9.html#cb8-79" aria-hidden="true" tabindex="-1"></a>BMDE_col<span class="ot">&lt;-</span><span class="fu">unique</span>(BMDE<span class="sc">$</span>local_name)</span>
<span id="cb8-80"><a href="Data9.html#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="Data9.html#cb8-81" aria-hidden="true" tabindex="-1"></a>missing<span class="ot">&lt;-</span><span class="fu">setdiff</span>(BMDE_col, <span class="fu">names</span>(ebird_data))</span>
<span id="cb8-82"><a href="Data9.html#cb8-82" aria-hidden="true" tabindex="-1"></a>ebird_data[missing]<span class="ot">&lt;-</span><span class="st">&quot; &quot;</span></span>
<span id="cb8-83"><a href="Data9.html#cb8-83" aria-hidden="true" tabindex="-1"></a>ebird_data<span class="ot">&lt;-</span>ebird_data[BMDE_col]</span></code></pre></div>
</div>
<div id="Data9.3.5" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> CBC<a href="Data9.html#Data9.3.5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To access CBC data you must contact Audubon at <a href="mailto:cbcadmin@audubon.org" class="email">cbcadmin@audubon.org</a>. A online form will be send to you to complete. When completing this form, scope the data to the geographic and temporal scale you require. You will also be asked if you want the auxiliary data included, such as effort and weather. Select yes to all options so that you have a complete dataset to work with.</p>
<p>You will receive the raw data compressed in a Box folder, which you can download and save to the <code>Data</code> directory associated with this project. You will also be given links to download the “cbc_field_definitions_2013.pdf”, which details the information in each data column, and the “CBCEditorialCodes.pdf”, which defines the modifiers used when recording species. Both of these files are saved in the <code>Data</code> directory of this project.</p>
<p>The tables provided will include:</p>
<ul>
<li><p>CBC_Circle_Species_Report: the raw counts of each species seen in each circle in each year</p></li>
<li><p>CBC_Effort_Many_Types: for each count circle in each year, this table details the mode of data collection (e.g., car, foot), distance traveled, and the number of hours the survey took.</p></li>
<li><p>CBC_Effort_Summary_Report: for each count in each year, this table details additional types of data collection effort, including field versus feeder counters, min and max parties, feeder hours, nocturnal hours, and nocturnal distance. These data are often used for effort correction.</p></li>
<li><p>CBC_Weather_Report: for each count circle in each year, this table details all th weather covarites collected during the survey.</p></li>
<li><p>CBC_Count_History_Report: this table detail when each count circle was run and in which years. This can be used to zero-fill the data matrix.</p></li>
</ul>
<p>We will once again work with the sample dataset here which has the same formatting as the full dataset that you will receive through the online download.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="Data9.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load Species Data</span></span>
<span id="cb9-2"><a href="Data9.html#cb9-2" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/CBC_Circle_Species_sample.csv&quot;</span>)</span>
<span id="cb9-3"><a href="Data9.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="Data9.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#separate columns</span></span>
<span id="cb9-5"><a href="Data9.html#cb9-5" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> <span class="fu">separate</span>(subnational_code, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;del&quot;</span>, <span class="st">&quot;StateProvince&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>del)</span>
<span id="cb9-6"><a href="Data9.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="Data9.html#cb9-7" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> <span class="fu">separate</span>(cnt_dt, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;del&quot;</span>), <span class="at">sep=</span><span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>del)</span>
<span id="cb9-8"><a href="Data9.html#cb9-8" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> <span class="fu">separate</span>(date, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;MonthCollected&quot;</span>, <span class="st">&quot;DayCollected&quot;</span>, <span class="st">&quot;YearCollected&quot;</span>), <span class="at">sep=</span><span class="st">&quot;/&quot;</span>)</span>
<span id="cb9-9"><a href="Data9.html#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="Data9.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#rename columns</span></span>
<span id="cb9-11"><a href="Data9.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#circle ID = RouteIdentifier</span></span>
<span id="cb9-12"><a href="Data9.html#cb9-12" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">RouteIdentifier=</span>abbrev, <span class="at">Locality=</span>name, <span class="at">DecimalLatitude=</span> latitude, <span class="at">DecimalLongitude=</span>longitude, <span class="at">Country=</span>country_code, <span class="at">CommonName =</span> com_name, <span class="at">ScientificName=</span>sci_name, <span class="at">ObservationCount =</span> how_many)</span>
<span id="cb9-13"><a href="Data9.html#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="Data9.html#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#load effort measurements</span></span>
<span id="cb9-15"><a href="Data9.html#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="Data9.html#cb9-16" aria-hidden="true" tabindex="-1"></a>CBC_eff<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/CBC_Effort_Many_Types_Report.csv&quot;</span>)</span>
<span id="cb9-17"><a href="Data9.html#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="Data9.html#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#convert from miles to km</span></span>
<span id="cb9-19"><a href="Data9.html#cb9-19" aria-hidden="true" tabindex="-1"></a>CBC_eff<span class="ot">&lt;-</span>CBC_eff <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">dist_km =</span> <span class="fu">ifelse</span>(distance_unit<span class="sc">==</span><span class="st">&quot;Miles&quot;</span>, distance<span class="sc">*</span><span class="fl">1.609344</span>, distance)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>distance, <span class="sc">-</span>OID_)</span>
<span id="cb9-20"><a href="Data9.html#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="Data9.html#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#create total distance travelled</span></span>
<span id="cb9-22"><a href="Data9.html#cb9-22" aria-hidden="true" tabindex="-1"></a>CBC_eff<span class="ot">&lt;-</span>CBC_eff <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(abbrev, name, count_yr) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">dis_tot=</span><span class="fu">sum</span>(dist_km), <span class="at">hour_tot=</span><span class="fu">sum</span>(hours)) </span>
<span id="cb9-23"><a href="Data9.html#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="Data9.html#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#rename columns</span></span>
<span id="cb9-25"><a href="Data9.html#cb9-25" aria-hidden="true" tabindex="-1"></a>CBC_eff<span class="ot">&lt;-</span>CBC_eff <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">RouteIdentifier=</span>abbrev, <span class="at">Locality=</span>name,  <span class="at">DurationInHours =</span> hour_tot, <span class="at">DistanceFromStart=</span> dis_tot)</span>
<span id="cb9-26"><a href="Data9.html#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="Data9.html#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#join tables</span></span>
<span id="cb9-28"><a href="Data9.html#cb9-28" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span><span class="fu">left_join</span>(CBC, CBC_eff, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;RouteIdentifier&quot;</span>, <span class="st">&quot;Locality&quot;</span>, <span class="st">&quot;count_yr&quot;</span>))</span>
<span id="cb9-29"><a href="Data9.html#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="Data9.html#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove subspecies since this does not allow tables to link </span></span>
<span id="cb9-31"><a href="Data9.html#cb9-31" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>CommonName<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">([^</span><span class="sc">\\</span><span class="st">)]+</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">as.character</span>(CBC<span class="sc">$</span>CommonName))</span>
<span id="cb9-32"><a href="Data9.html#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="Data9.html#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#replace Thayer&#39;s Gull with Ivory Gull</span></span>
<span id="cb9-34"><a href="Data9.html#cb9-34" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CommonName =</span> <span class="fu">ifelse</span>(CommonName <span class="sc">==</span> <span class="st">&quot;Thayer&#39;s Gull&quot;</span>, <span class="st">&quot;Ivory Gull&quot;</span>, CommonName))</span>
<span id="cb9-35"><a href="Data9.html#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="Data9.html#cb9-36" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span><span class="fu">merge</span>(CBC, sp, <span class="at">by.x=</span><span class="st">&quot;CommonName&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;english_name&quot;</span>)</span>
<span id="cb9-37"><a href="Data9.html#cb9-37" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>ScientificName) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ScientificName =</span> scientific_name, <span class="at">SpeciesCode=</span>species_code)</span>
<span id="cb9-38"><a href="Data9.html#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="Data9.html#cb9-39" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>BasisOfRecord <span class="ot">&lt;-</span> <span class="st">&quot;Observation&quot;</span></span>
<span id="cb9-40"><a href="Data9.html#cb9-40" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>CollectionCode <span class="ot">&lt;-</span> <span class="st">&quot;CBC&quot;</span></span>
<span id="cb9-41"><a href="Data9.html#cb9-41" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>Continent <span class="ot">&lt;-</span><span class="st">&quot;North America&quot;</span></span>
<span id="cb9-42"><a href="Data9.html#cb9-42" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>ProtocolSpeciesTargeted <span class="ot">&lt;-</span> <span class="st">&quot;All birds&quot;</span></span>
<span id="cb9-43"><a href="Data9.html#cb9-43" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>InstitutionCode<span class="ot">&lt;-</span><span class="st">&quot;Audubon&quot;</span></span>
<span id="cb9-44"><a href="Data9.html#cb9-44" aria-hidden="true" tabindex="-1"></a>CBC<span class="sc">$</span>ProtocolURL<span class="ot">=</span><span class="st">&quot;https://www.audubon.org/conservation/science/christmas-bird-count&quot;</span></span>
<span id="cb9-45"><a href="Data9.html#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="Data9.html#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Now that we have specified all the data columns we can, we will create the BMDE standardized data table. </span></span>
<span id="cb9-47"><a href="Data9.html#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="Data9.html#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">#Identify the missing columns of data</span></span>
<span id="cb9-49"><a href="Data9.html#cb9-49" aria-hidden="true" tabindex="-1"></a>BMDE_col<span class="ot">&lt;-</span><span class="fu">unique</span>(BMDE<span class="sc">$</span>local_name)</span>
<span id="cb9-50"><a href="Data9.html#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="Data9.html#cb9-51" aria-hidden="true" tabindex="-1"></a>missing<span class="ot">&lt;-</span><span class="fu">setdiff</span>(BMDE_col, <span class="fu">names</span>(CBC))</span>
<span id="cb9-52"><a href="Data9.html#cb9-52" aria-hidden="true" tabindex="-1"></a>CBC[missing]<span class="ot">&lt;-</span><span class="st">&quot; &quot;</span></span>
<span id="cb9-53"><a href="Data9.html#cb9-53" aria-hidden="true" tabindex="-1"></a>CBC<span class="ot">&lt;-</span>CBC[BMDE_col]</span></code></pre></div>
</div>
<div id="Data9.3.6" class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> All Data Combined<a href="Data9.html#Data9.3.6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that all the datasets are in the BMDE format, we can simply bind these together into a single dataset.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="Data9.html#cb10-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">rbind</span>(BCCWS, BCMA, PSSS, PSEMP, ebird_data, CBC)</span>
<span id="cb10-2"><a href="Data9.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="Data9.html#cb10-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>YearCollected<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>YearCollected)</span>
<span id="cb10-4"><a href="Data9.html#cb10-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>MonthCollected<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>MonthCollected)</span>
<span id="cb10-5"><a href="Data9.html#cb10-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>DayCollected<span class="ot">&lt;-</span><span class="fu">as.numeric</span>((dat<span class="sc">$</span>DayCollected))</span>
<span id="cb10-6"><a href="Data9.html#cb10-6" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ObservationCount<span class="ot">&lt;-</span><span class="fu">as.numeric</span>((dat<span class="sc">$</span>ObservationCount))</span></code></pre></div>
</div>
</div>
<div id="Data9.4" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Zero-filling dataframe<a href="Data9.html#Data9.4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that you have a complete dateframe you will notice that in the <code>ObervationCount</code> column there are no zero counts. This is because surveyors only count what is present at a site, as opposed to what is not present (i.e., zero counts). Properly zero-filling your dataframe is important for most research purposes. It tells you when a site was surveyed, but a species of interest was not detected.</p>
<p>To property zero-fill a dataframe you will want to create an <code>events matrix</code> using the full dataset (i.e., one which covers the temporal and spatial scale of interest). This <code>event matrix</code> will tell us which sites were surveyed and when. Then we can use this matrix to add the zeros during a species specific analysis. We don’t add all the zeros to the occurrence dataset, because this would get very large.</p>
<p><strong>Note: the creation of the events matrix assumes that at least one species was detected at each survey point. This assumption is nearly always true</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Data9.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create the events matrix</span></span>
<span id="cb11-2"><a href="Data9.html#cb11-2" aria-hidden="true" tabindex="-1"></a>event<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb11-3"><a href="Data9.html#cb11-3" aria-hidden="true" tabindex="-1"></a>events<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(YearCollected, MonthCollected, DayCollected, DecimalLatitude, DecimalLongitude, RouteIdentifier) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb11-4"><a href="Data9.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="Data9.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#example of how to use the events matrix to zero-fill for Surf Scoter</span></span>
<span id="cb11-6"><a href="Data9.html#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="Data9.html#cb11-7" aria-hidden="true" tabindex="-1"></a>SUSC<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SpeciesCode<span class="sc">==</span><span class="st">&quot;SUSC&quot;</span>)</span>
<span id="cb11-8"><a href="Data9.html#cb11-8" aria-hidden="true" tabindex="-1"></a>SUSC<span class="ot">&lt;-</span><span class="fu">left_join</span>(events, SUSC, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;YearCollected&quot;</span>, <span class="st">&quot;MonthCollected&quot;</span>, <span class="st">&quot;DayCollected&quot;</span>, <span class="st">&quot;DecimalLatitude&quot;</span>, <span class="st">&quot;DecimalLongitude&quot;</span>, <span class="st">&quot;RouteIdentifier&quot;</span>))</span>
<span id="cb11-9"><a href="Data9.html#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="Data9.html#cb11-10" aria-hidden="true" tabindex="-1"></a>species<span class="ot">&lt;-</span><span class="st">&quot;SUSC&quot;</span></span>
<span id="cb11-11"><a href="Data9.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="Data9.html#cb11-12" aria-hidden="true" tabindex="-1"></a>SUSC<span class="ot">&lt;-</span>SUSC <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ObservationCount =</span> <span class="fu">replace</span>(ObservationCount, <span class="fu">is.na</span>(ObservationCount), <span class="dv">0</span>),</span>
<span id="cb11-13"><a href="Data9.html#cb11-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">SpeciesCode =</span> species)</span></code></pre></div>
</div>
<div id="Data9.5" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Checking and removing duplicates<a href="Data9.html#Data9.5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because some people use eBird to submit there data for various programs, there is a potential for duplicates in the full dataset. The <code>events matrix</code> does not allow multiple observations/ reports on the same day at the same location (latitude &amp; longitude), so by merging your species specific table to the events matrix, you should eliminate duplicates. If you want to ensure there are no duplicates you can run the following sample code.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="Data9.html#cb12-1" aria-hidden="true" tabindex="-1"></a>distinct<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(YearCollected, MonthCollected, DayCollected, TimeCollected, DecimalLatitude, DecimalLongitude, SpeciesCode, ObservationCount, RouteIdentifier, Locality, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="Data9.6" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Assigning survey period<a href="Data9.html#Data9.6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Winter surveys more than often straddle two calendar years (e.g., start in October 2021 and end in April 2022). When doing an analysis you are often interested in ‘year’ as a covarite or random effect. We will call this data column survey <code>Period</code>, and will assign this the start year of the surveys.</p>
<p>NOTE: The PSEMP dataset contains the <code>SurveyYear</code> which is the end year of the survey period. We removed this during data processing but will add it back here.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="Data9.html#cb13-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>Period <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dat<span class="sc">$</span>MonthCollected <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">12</span>), dat<span class="sc">$</span>YearCollected, </span>
<span id="cb13-2"><a href="Data9.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>YearCollected<span class="dv">-1</span>) </span></code></pre></div>
</div>
<div id="Data9.7" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Remove out of range species/ unsuitable habitat<a href="Data9.html#Data9.7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some surveys, like the CBC and eBird, are not specifically targeted towards sea ducks or other species of interest. We will therefore have surveys that are not of value to our assessment. There are several ways to filter these data, but what I find easy is identifying survey locations where an individual is not repeatably identified (e.g., &lt;=1), and remove these from the <code>events</code> list used for zero-filling.</p>
<p>NOTE: I would work this into your data processing loop if doing this for many species</p>
<p>Let’s use SUSC again as an example.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Data9.html#cb14-1" aria-hidden="true" tabindex="-1"></a>site.summ <span class="ot">&lt;-</span> <span class="fu">melt</span>(dat, <span class="at">id.var =</span> <span class="fu">c</span>(<span class="st">&quot;RouteIdentifier&quot;</span>, <span class="st">&quot;SpeciesCode&quot;</span>), <span class="at">measure.var =</span> <span class="st">&quot;ObservationCount&quot;</span>)</span>
<span id="cb14-2"><a href="Data9.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="Data9.html#cb14-3" aria-hidden="true" tabindex="-1"></a>site.summ <span class="ot">&lt;-</span> <span class="fu">cast</span>(site.summ, RouteIdentifier <span class="sc">+</span> SpeciesCode <span class="sc">~</span> variable, sum)</span>
<span id="cb14-4"><a href="Data9.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="Data9.html#cb14-5" aria-hidden="true" tabindex="-1"></a>site.sp.list <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">subset</span>(site.summ, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">&quot;RouteIdentifier&quot;</span>, <span class="st">&quot;SpeciesCode&quot;</span>), ObservationCount <span class="sc">&gt;</span> <span class="dv">1</span>))</span>
<span id="cb14-6"><a href="Data9.html#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="Data9.html#cb14-7" aria-hidden="true" tabindex="-1"></a>site.SUSC.list<span class="ot">&lt;-</span>site.sp.list <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SpeciesCode<span class="sc">==</span><span class="st">&quot;SUSC&quot;</span>) <span class="co">#this will be your &#39;range&#39; list for SUSC. You can used this to remove out of range or rare records. </span></span>
<span id="cb14-8"><a href="Data9.html#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="Data9.html#cb14-9" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span><span class="fu">left_join</span>(site.SUSC.list, SUSC, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;SpeciesCode&quot;</span>, <span class="st">&quot;RouteIdentifier&quot;</span>))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="CBC7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ADD9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
